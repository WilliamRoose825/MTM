@startuml class-diagram
hide empty methods
skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam defaultFontName JetBrains Mono, Consolas, monospace
skinparam dpi 150
skinparam linetype ortho

title Architecture logique (core / components / app)

package "app" {
    class App {
        -AppConfig config
        +run()
    }
    class AppConfig {
        +Path default_recipes_path
        +Path default_interactions_path
        +str page_title
        +str layout
    }
}

package "core" {
    class DataLoader {
        -Path data_path
        -bool cache
        -DataFrame _df
        +load_data(): DataFrame
        +get_data(): DataFrame
    }

    class DataExplorer {
        -DataLoader loader
        +df : DataFrame <<property>>
    }

    class PreprocessingConfig <<dataclass>> {
        +bool enable_preprocessing
        +str outlier_method
        +float outlier_threshold
        +bool enable_cache
    }

    class InteractionsAnalyzer <<dataclass>> {
        +DataFrame? interactions
        +DataFrame? recipes
        +PreprocessingConfig? preprocessing
        -DataFrame _df
        -dict _popularity_segments_info
        +aggregate(): DataFrame
        +popularity_vs_rating(): DataFrame
        +create_popularity_segments(): DataFrame
    }

    class IngredientsAnalyzer {
        -DataFrame data
        -list ingredient_names
        -DataFrame ingredients_matrix
        +process_ingredients(): (DataFrame, list)
        +perform_clustering(): ndarray
    }
}

package "components" {
    class IngredientsClusteringPage {
        -str default_recipes_path
        +render_sidebar(): dict
    }

    class PopularityAnalysisPage {
        -PopularityAnalysisConfig config
        +run()
    }

    class PopularityAnalysisConfig {
        +Path interactions_path
        +Path recipes_path
    }
}

' ================= Relationships =================
App --> AppConfig : configure
App --> DataLoader : utilise
App --> DataExplorer : instancie
App --> IngredientsClusteringPage : page
App --> PopularityAnalysisPage : page

DataExplorer --> DataLoader : charge
InteractionsAnalyzer --> DataLoader : (données brutes)
InteractionsAnalyzer --> PreprocessingConfig : configure
IngredientsAnalyzer --> DataLoader : (données recettes)

PopularityAnalysisPage --> InteractionsAnalyzer : analyse
PopularityAnalysisPage --> PopularityAnalysisConfig : configure
IngredientsClusteringPage --> IngredientsAnalyzer : analyse

note right of PreprocessingConfig
    Configuration IQR:
    - Seuil configurable (1.0-20.0)
    - Méthode outlier (iqr/zscore)
    - Features à traiter
    - Cache activable
end note

note right of InteractionsAnalyzer
    Analyse avancée:
    - Popularité / notes avec preprocessing
    - Segmentation automatique (4 niveaux)
    - Jointure interactions + recettes
end note

note right of PopularityAnalysisPage
    Interface complète en 4 étapes:
    - Relation qualité-popularité
    - Segmentation par engagement
    - Facteurs d'influence
    - Analyse temporelle 3D
end note

note right of App
    Application Streamlit:
    - Home (exploration générale)
    - Clustering ingrédients
    - Popularité recettes
end note

@enduml
